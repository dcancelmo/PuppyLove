<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Socket.IO Chat Example</title>
        <script src="http://127.0.0.1:3000/socket.io/socket.io.js"></script>
        <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
        <link rel = "stylesheet" type = "text/css" href = "style/styleDash.css" />
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            body {
                font: 13px Helvetica, Arial;
            }
            form {
                background: #000;
                padding: 3px;
                position: fixed;
                bottom: 0;
                width: 100%;
            }
            form input {
                border: 0;
                padding: 10px;
                width: 90%;
                margin-right: .5%;
            }
            form button {
                width: 9%;
                background: rgb(130, 224, 255);
                border: none;
                padding: 10px;
            }
            #messages {
                list-style-type: none;
                margin: 0;
                padding: 0;
            }
            #messages li {
                padding: 5px 10px;
            }
            #messages li:nth-child(odd) {
                background: #eee;
            }
        </style>
    </head>
    <body>
    <div id = "navbar">
        <ul>
            <li><a href = "dashboard.html">Dashboard</a></li>
            <li><a href="view_profile.html">Profile</a></li>
            <li><a href = "">Matches</a></li>
            <li><a href = "messages.html">Messages</a></li>
            <li><a href = "user_profile.html">Settings</a></li>
            <li><a href = "cgi-bin/logout.py">Log out</a></li>
        </ul>
    </div>
   
    <div id = "messages" style = "margin-left:100px">
        <ul id="messages"></ul>
      
        <form action="">
            <input id="m" autocomplete="off"/><button>Send</button>
        </form>
    </div>
        <script>
            function readCookie(name) {
                var nameEQ = name + "=";
                var ca = document.cookie.split(';');
                for (var i = 0; i < ca.length; i++) {
                    var c = ca[i];
                    while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                    if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
                }
                return null;
            }
            // web sockets do allow cross-domain connections.  It is generally up to the
            // server to determine whether or not a connection from an incoming client
            // should be accepted or not.
            // no URL is specified when this socket is opened because by default the
            // socket will try to connect back to the host from which this page was
            // served (which in this case is the desired behavior).
            var socket = io.connect('http://127.0.0.1:3000');
            // this function is called when the user presses ENTER or clicks the Submit
            // button in the form.
            $('form').submit(function() {
                $.ajax({
                    url:'cgi-bin/get_username.py',
                    type: 'GET',
                    dataType: 'text',
                    success: function(response){
                        var response = JSON.parse(response);
                        var username = response.username;
                        var message = username + ": " + $('#m').val();
                        console.log(username);
                        console.log("should transmit message: " + message);
                        socket.emit('chat message', message);
                        $('#m').val('');
                    }
                });
                return false;
            });

            socket.on('chat message', function(msg) {
                $('#messages').append($('<li>').text(msg));
                // add the contents of the message to the unordered list.
            });
         </script>
    </body>
</html>